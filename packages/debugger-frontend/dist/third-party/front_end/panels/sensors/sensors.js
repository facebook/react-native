import"../../ui/components/cards/cards.js";import*as t from"../../core/common/common.js";import*as e from"../../core/i18n/i18n.js";import*as i from"../../ui/components/buttons/buttons.js";import*as o from"../../ui/legacy/legacy.js";import*as n from"../../ui/visual_logging/visual_logging.js";import*as a from"../../core/host/host.js";import*as r from"../../core/sdk/sdk.js";import*as l from"../mobile_throttling/mobile_throttling.js";var s={cssText:`.add-locations-button{margin-bottom:var(--sys-size-5);border:none}.locations-list{margin-top:var(--sys-size-3);flex:auto}.locations-list-item{padding:3px 6px;height:30px;display:flex;align-items:center;position:relative;flex:auto 1 1}.locations-list-text{white-space:nowrap;text-overflow:ellipsis;flex-basis:170px;user-select:none;color:var(--sys-color-on-surface);position:relative;overflow:hidden}.locations-list-title{text-align:start}.locations-list-title-text{overflow:hidden;flex:auto;white-space:nowrap;text-overflow:ellipsis}.locations-list-separator{flex:0 0 1px;background-color:var(--sys-color-divider);height:30px;margin:0 4px}.locations-list-separator-invisible{visibility:hidden;height:100%!important}.locations-edit-row{display:flex;flex-direction:row;margin:6px 5px}.locations-edit-row input{width:100%;text-align:inherit}.locations-input-container{padding:1px}.settings-card-container-wrapper{scrollbar-gutter:stable;padding:var(--sys-size-8) 0;overflow:auto;position:absolute;inset:var(--sys-size-8) 0 0}.settings-card-container{display:flex;flex-direction:column;align-items:center;gap:var(--sys-size-9)}\n/*# sourceURL=${import.meta.resolve("./locationsSettingsTab.css")} */\n`};const c={locations:"Locations",locationName:"Location name",lat:"Lat",long:"Long",timezoneId:"Timezone ID",locale:"Locale",latitude:"Latitude",longitude:"Longitude",locationNameCannotBeEmpty:"Location name cannot be empty",locationNameMustBeLessThanS:"Location name must be less than {PH1} characters",latitudeMustBeANumber:"Latitude must be a number",latitudeMustBeGreaterThanOrEqual:"Latitude must be greater than or equal to {PH1}",latitudeMustBeLessThanOrEqualToS:"Latitude must be less than or equal to {PH1}",longitudeMustBeANumber:"Longitude must be a number",longitudeMustBeGreaterThanOr:"Longitude must be greater than or equal to {PH1}",longitudeMustBeLessThanOrEqualTo:"Longitude must be less than or equal to {PH1}",timezoneIdMustContainAlphabetic:"Timezone ID must contain alphabetic characters",localeMustContainAlphabetic:"Locale must contain alphabetic characters",addLocation:"Add location"},d=e.i18n.registerUIStrings("panels/sensors/LocationsSettingsTab.ts",c),h=e.i18n.getLocalizedString.bind(void 0,d);class u extends o.Widget.VBox{list;customSetting;editor;constructor(){super(!0),this.registerRequiredCSS(s),this.element.setAttribute("jslog",`${n.pane("emulation-locations")}`);const e=this.contentElement.createChild("div","settings-card-container-wrapper").createChild("div");e.classList.add("settings-card-container");const a=e.createChild("devtools-card");a.heading=h(c.locations);const r=a.createChild("div");this.list=new o.ListWidget.ListWidget(this,void 0,!0),this.list.element.classList.add("locations-list"),this.list.registerRequiredCSS(s),this.list.show(r),this.customSetting=t.Settings.Settings.instance().moduleSetting("emulation.locations");const l=this.customSetting.get().map((t=>function(t,e){if(!t.title){const i=e.find((e=>e.lat===t.lat&&e.long===t.long&&e.timezoneId===t.timezoneId&&e.locale===t.locale));if(i)return i;console.error("Could not determine a location setting title")}return t}(t,this.customSetting.defaultValue)));const d=new i.Button.Button;d.classList.add("add-locations-button"),d.data={variant:"outlined",iconName:"plus",jslogContext:"emulation.add-location"},d.textContent=h(c.addLocation),d.addEventListener("click",(()=>this.addButtonClicked())),a.append(d),this.customSetting.set(l),this.customSetting.addChangeListener(this.locationsUpdated,this)}wasShown(){super.wasShown(),this.locationsUpdated()}locationsUpdated(){this.list.clear();const t=this.customSetting.get();for(const e of t)this.list.appendItem(e,!0);this.list.appendSeparator()}addButtonClicked(){this.list.addNewItem(this.customSetting.get().length,{title:"",lat:0,long:0,timezoneId:"",locale:""})}renderItem(t,e){const i=document.createElement("div");i.role="row",i.classList.add("locations-list-item");const n=i.createChild("div","locations-list-text locations-list-title");n.role="cell";const a=n.createChild("div","locations-list-title-text");a.textContent=t.title,o.Tooltip.Tooltip.install(a,t.title),i.createChild("div","locations-list-separator");const r=i.createChild("div","locations-list-text");r.textContent=String(t.lat),r.role="cell",i.createChild("div","locations-list-separator");const l=i.createChild("div","locations-list-text");l.textContent=String(t.long),l.role="cell",i.createChild("div","locations-list-separator");const s=i.createChild("div","locations-list-text");s.textContent=t.timezoneId,s.role="cell",i.createChild("div","locations-list-separator");const c=i.createChild("div","locations-list-text");return c.textContent=t.locale,c.role="cell",i}removeItemRequested(t,e){const i=this.customSetting.get();i.splice(e,1),this.customSetting.set(i)}commitEdit(t,e,i){t.title=e.control("title").value.trim();const o=e.control("lat").value.trim();t.lat=o?parseFloat(o):0;const n=e.control("long").value.trim();t.long=n?parseFloat(n):0;const a=e.control("timezone-id").value.trim();t.timezoneId=a;const r=e.control("locale").value.trim();t.locale=r;const l=this.customSetting.get();i&&l.push(t),this.customSetting.set(l)}beginEdit(t){const e=this.createEditor();return e.control("title").value=t.title,e.control("lat").value=String(t.lat),e.control("long").value=String(t.long),e.control("timezone-id").value=t.timezoneId,e.control("locale").value=t.locale,e}createEditor(){if(this.editor)return this.editor;const t=new o.ListWidget.Editor;this.editor=t;const e=t.contentElement(),i=e.createChild("div","locations-edit-row");i.createChild("div","locations-list-text locations-list-title").textContent=h(c.locationName),i.createChild("div","locations-list-separator locations-list-separator-invisible"),i.createChild("div","locations-list-text").textContent=h(c.lat),i.createChild("div","locations-list-separator locations-list-separator-invisible"),i.createChild("div","locations-list-text").textContent=h(c.long),i.createChild("div","locations-list-separator locations-list-separator-invisible"),i.createChild("div","locations-list-text").textContent=h(c.timezoneId),i.createChild("div","locations-list-separator locations-list-separator-invisible"),i.createChild("div","locations-list-text").textContent=h(c.locale);const n=e.createChild("div","locations-edit-row");n.createChild("div","locations-list-text locations-list-title locations-input-container").appendChild(t.createInput("title","text",h(c.locationName),(function(t,e,i){const o=i.value.trim();let n;o.length?o.length>50&&(n=h(c.locationNameMustBeLessThanS,{PH1:50})):n=h(c.locationNameCannotBeEmpty);if(n)return{valid:!1,errorMessage:n};return{valid:!0,errorMessage:void 0}}))),n.createChild("div","locations-list-separator locations-list-separator-invisible");let a=n.createChild("div","locations-list-text locations-input-container");return a.appendChild(t.createInput("lat","text",h(c.latitude),(function(t,e,i){const o=i.value.trim(),n=Number(o);if(!o)return{valid:!0,errorMessage:void 0};let a;Number.isNaN(n)?a=h(c.latitudeMustBeANumber):parseFloat(o)<-90?a=h(c.latitudeMustBeGreaterThanOrEqual,{PH1:-90}):parseFloat(o)>90&&(a=h(c.latitudeMustBeLessThanOrEqualToS,{PH1:90}));if(a)return{valid:!1,errorMessage:a};return{valid:!0,errorMessage:void 0}}))),n.createChild("div","locations-list-separator locations-list-separator-invisible"),a=n.createChild("div","locations-list-text locations-list-text-longitude locations-input-container"),a.appendChild(t.createInput("long","text",h(c.longitude),(function(t,e,i){const o=i.value.trim(),n=Number(o);if(!o)return{valid:!0,errorMessage:void 0};let a;Number.isNaN(n)?a=h(c.longitudeMustBeANumber):parseFloat(o)<-180?a=h(c.longitudeMustBeGreaterThanOr,{PH1:-180}):parseFloat(o)>180&&(a=h(c.longitudeMustBeLessThanOrEqualTo,{PH1:180}));if(a)return{valid:!1,errorMessage:a};return{valid:!0,errorMessage:void 0}}))),n.createChild("div","locations-list-separator locations-list-separator-invisible"),a=n.createChild("div","locations-list-text locations-input-container"),a.appendChild(t.createInput("timezone-id","text",h(c.timezoneId),(function(t,e,i){const o=i.value.trim();if(""===o||/[a-zA-Z]/.test(o))return{valid:!0,errorMessage:void 0};return{valid:!1,errorMessage:h(c.timezoneIdMustContainAlphabetic)}}))),n.createChild("div","locations-list-separator locations-list-separator-invisible"),a=n.createChild("div","locations-list-text locations-input-container"),a.appendChild(t.createInput("locale","text",h(c.locale),(function(t,e,i){const o=i.value.trim();if(""===o||/[a-zA-Z]{2}/.test(o))return{valid:!0,errorMessage:void 0};return{valid:!1,errorMessage:h(c.localeMustContainAlphabetic)}}))),t}}var p=Object.freeze({__proto__:null,LocationsSettingsTab:u}),m={cssText:`.sensors-view{padding:12px;display:block}.sensors-view input{width:100%;max-width:120px;margin:-5px 10px 0 0;text-align:end}.sensors-view input[readonly]{background-color:var(--sys-color-neutral-container)}.sensors-view fieldset{border:none;padding:10px 0;flex:0 0 auto;margin:0}.sensors-view fieldset[disabled]{opacity:50%}.orientation-axis-input-container input{max-width:120px}.concurrency-details{margin:var(--sys-size-5) var(--sys-size-10);display:flex;align-items:center}.concurrency-details input{width:50px;margin:0}.concurrency-hidden{visibility:hidden}.sensors-view input:focus::-webkit-input-placeholder{color:transparent!important}.sensors-view select{width:200px}.sensors-group-title{width:80px;line-height:24px}.sensors-group{display:flex;flex-wrap:wrap;margin-bottom:10px}.manage-locations{margin-left:var(--sys-size-4)}.geo-fields{flex:2 0 200px}.latlong-group{display:flex;margin-bottom:10px}.latlong-title{width:70px}.timezone-error,\n.locale-error{margin-left:10px;color:var(--legacy-input-validation-error)}.orientation-content{display:flex;flex-wrap:wrap}.orientation-fields{margin-right:10px}.orientation-stage{--override-gradient-color-1:var(--ref-palette-cyan95);--override-gradient-color-2:var(--ref-palette-cyan90);perspective:700px;perspective-origin:50% 50%;width:160px;height:150px;background:linear-gradient(var(--override-gradient-color-1) 0%,var(--override-gradient-color-1) 64%,var(--override-gradient-color-2) 64%,var(--override-gradient-color-1) 100%);transition:0.2s ease opacity,0.2s ease filter;overflow:hidden;margin-bottom:10px}.theme-with-dark-background .orientation-stage,\n:host-context(.theme-with-dark-background) .orientation-stage{--override-gradient-color-1:var(--ref-palette-cyan10);--override-gradient-color-2:var(--ref-palette-cyan30)}.orientation-stage.disabled{filter:grayscale();opacity:50%}.orientation-element,\n.orientation-element::before,\n.orientation-element::after{position:absolute;box-sizing:border-box;transform-style:preserve-3d;background:no-repeat;background-size:cover;backface-visibility:hidden}.orientation-box{width:62px;height:122px;inset:0;margin:auto;transform:rotate3d(1,0,0,90deg)}.orientation-layer{width:100%;height:100%;transform-style:preserve-3d}.orientation-box.is-animating,\n.is-animating .orientation-layer{transition:transform 300ms cubic-bezier(0.4,0,0.2,1) 0ms}.orientation-front,\n.orientation-back{width:62px;height:122px;border-radius:8px}.orientation-front{background-image:var(--image-file-accelerometer-front)}.orientation-back{transform:rotateY(180deg) translateZ(8px);background-image:var(--image-file-accelerometer-back)}.orientation-left,\n.orientation-right{width:8px;height:106px;top:8px;background-position:center center}.orientation-left{left:-8px;transform-origin:right center;transform:rotateY(-90deg);background-image:var(--image-file-accelerometer-left)}.orientation-right{right:-8px;transform-origin:left center;transform:rotateY(90deg);background-image:var(--image-file-accelerometer-right)}.orientation-left::before,\n.orientation-left::after,\n.orientation-right::before,\n.orientation-right::after{content:"";width:8px;height:6px}.orientation-left::before,\n.orientation-left::after{background-image:var(--image-file-accelerometer-left)}.orientation-right::before,\n.orientation-right::after{background-image:var(--image-file-accelerometer-right)}.orientation-left::before,\n.orientation-right::before{top:-6px;transform-origin:center bottom;transform:rotateX(26deg);background-position:center top}.orientation-left::after,\n.orientation-right::after{bottom:-6px;transform-origin:center top;transform:rotateX(-25deg);background-position:center bottom}.orientation-top,\n.orientation-bottom{width:50px;height:8px;left:8px;background-position:center center}.orientation-top{top:-8px;transform-origin:center bottom;transform:rotateX(90deg);background-image:var(--image-file-accelerometer-top)}.orientation-bottom{bottom:-8px;transform-origin:center top;transform:rotateX(-90deg);background-image:var(--image-file-accelerometer-bottom)}.orientation-top::before,\n.orientation-top::after,\n.orientation-bottom::before,\n.orientation-bottom::after{content:"";width:8px;height:8px}.orientation-top::before,\n.orientation-top::after{background-image:var(--image-file-accelerometer-top)}.orientation-bottom::before,\n.orientation-bottom::after{background-image:var(--image-file-accelerometer-bottom)}.orientation-top::before,\n.orientation-bottom::before{left:-6px;transform-origin:right center;transform:rotateY(-26deg);background-position:left center}.orientation-top::after,\n.orientation-bottom::after{right:-6px;transform-origin:left center;transform:rotateY(26deg);background-position:right center}.orientation-axis-input-container{margin-bottom:10px}.orientation-reset-button{min-width:80px}fieldset.device-orientation-override-section{margin:0;display:flex}.panel-section-separator{height:1px;margin-bottom:20px;margin-left:-12px;margin-right:-12px;background:var(--sys-color-divider)}button.text-button{margin:4px 0 0 10px}@media (forced-colors: active){.sensors-view fieldset[disabled]{opacity:100%}}.chrome-select-label{margin-bottom:16px}\n/*# sourceURL=${import.meta.resolve("./sensors.css")} */\n`};const g={location:"Location",noOverride:"No override",overrides:"Overrides",manage:"Manage",manageTheListOfLocations:"Manage the list of locations",other:"Other…",error:"Error",locationUnavailable:"Location unavailable",adjustWithMousewheelOrUpdownKeys:"Adjust with mousewheel or up/down keys. {PH1}: ±10, Shift: ±1, Alt: ±0.01",latitude:"Latitude",longitude:"Longitude",timezoneId:"Timezone ID",locale:"Locale",orientation:"Orientation",off:"Off",customOrientation:"Custom orientation",enableOrientationToRotate:"Enable orientation to rotate",shiftdragHorizontallyToRotate:"Shift+drag horizontally to rotate around the y-axis",deviceOrientationSetToAlphaSBeta:"Device orientation set to alpha: {PH1}, beta: {PH2}, gamma: {PH3}",reset:"Reset",resetDeviceOrientation:"Reset device orientation",forcesTouchInsteadOfClick:"Forces touch instead of click",forcesSelectedIdleStateEmulation:"Forces selected idle state emulation",forcesSelectedPressureStateEmulation:"Forces selected pressure state emulation",presets:"Presets",portrait:"Portrait",portraitUpsideDown:"Portrait upside down",landscapeLeft:"Landscape left",landscapeRight:"Landscape right",displayUp:"Display up",displayDown:"Display down",alpha:"α (alpha)",beta:"β (beta)",gamma:"γ (gamma)"},v=e.i18n.registerUIStrings("panels/sensors/SensorsView.ts",g),b=e.i18n.getLocalizedString.bind(void 0,v);class f extends o.Widget.VBox{#t;#e;#i;fieldsetElement;timezoneError;locationSelectElement;latitudeInput;longitudeInput;timezoneInput;localeInput;latitudeSetter;longitudeSetter;timezoneSetter;localeSetter;localeError;customLocationsGroup;deviceOrientationSetting;deviceOrientation;deviceOrientationOverrideEnabled;deviceOrientationFieldset;stageElement;orientationSelectElement;alphaElement;betaElement;gammaElement;alphaSetter;betaSetter;gammaSetter;orientationLayer;boxElement;boxMatrix;mouseDownVector;originalBoxMatrix;constructor(){super(!0),this.registerRequiredCSS(m),this.element.setAttribute("jslog",`${n.panel("sensors").track({resize:!0})}`),this.contentElement.classList.add("sensors-view"),this.#t=t.Settings.Settings.instance().createSetting("emulation.location-override",""),this.#e=r.EmulationModel.Location.parseSetting(this.#t.get()),this.#i=!1,this.createLocationSection(this.#e),this.createPanelSeparator(),this.deviceOrientationSetting=t.Settings.Settings.instance().createSetting("emulation.device-orientation-override",""),this.deviceOrientation=r.EmulationModel.DeviceOrientation.parseSetting(this.deviceOrientationSetting.get()),this.deviceOrientationOverrideEnabled=!1,this.createDeviceOrientationSection(),this.createPanelSeparator(),this.appendTouchControl(),this.createPanelSeparator(),this.appendIdleEmulator(),this.createPanelSeparator(),this.createHardwareConcurrencySection(),this.createPanelSeparator(),this.createPressureSection(),this.createPanelSeparator()}createPanelSeparator(){this.contentElement.createChild("div").classList.add("panel-section-separator")}createLocationSection(e){const i=this.contentElement.createChild("section","sensors-group");i.setAttribute("jslog",`${n.section("location")}`);const l=o.UIUtils.createLabel(b(g.location),"sensors-group-title");i.appendChild(l);const s=i.createChild("div","geo-fields");let c=0;const d={title:b(g.noOverride),location:x.NoOverride};this.locationSelectElement=s.createChild("select"),this.locationSelectElement.setAttribute("jslog",`${n.dropDown().track({change:!0})}`),o.ARIAUtils.bindLabelToControl(l,this.locationSelectElement),this.locationSelectElement.appendChild(o.UIUtils.createOption(d.title,d.location,"no-override")),this.customLocationsGroup=this.locationSelectElement.createChild("optgroup"),this.customLocationsGroup.label=b(g.overrides);const h=t.Settings.Settings.instance().moduleSetting("emulation.locations"),u=o.UIUtils.createTextButton(b(g.manage),(()=>t.Revealer.reveal(h)),{className:"manage-locations",jslogContext:"sensors.manage-locations"});o.ARIAUtils.setLabel(u,b(g.manageTheListOfLocations)),s.appendChild(u);const p=()=>{if(this.customLocationsGroup){this.customLocationsGroup.removeChildren();for(const[t,i]of h.get().entries())this.customLocationsGroup.appendChild(o.UIUtils.createOption(i.title,JSON.stringify(i),"custom")),e.latitude===i.lat&&e.longitude===i.long&&(c=t+1)}};h.addChangeListener(p),p();const m={title:b(g.other),location:x.Custom};this.locationSelectElement.appendChild(o.UIUtils.createOption(m.title,m.location,"other"));const v=this.locationSelectElement.createChild("optgroup");v.label=b(g.error),v.appendChild(o.UIUtils.createOption(b(g.locationUnavailable),x.Unavailable,"unavailable")),this.locationSelectElement.selectedIndex=c,this.locationSelectElement.addEventListener("change",this.#o.bind(this)),this.fieldsetElement=s.createChild("fieldset"),this.fieldsetElement.disabled=!this.#i,this.fieldsetElement.id="location-override-section";const f=this.fieldsetElement.createChild("div","latlong-group"),S=this.fieldsetElement.createChild("div","latlong-group"),C=this.fieldsetElement.createChild("div","latlong-group"),E=this.fieldsetElement.createChild("div","latlong-group"),I=a.Platform.isMac()?"⌘":"Ctrl",O=b(g.adjustWithMousewheelOrUpdownKeys,{PH1:I});this.latitudeInput=o.UIUtils.createInput("","number","latitude"),f.appendChild(this.latitudeInput),this.latitudeInput.setAttribute("step","any"),this.latitudeInput.value="0",this.latitudeSetter=o.UIUtils.bindInput(this.latitudeInput,this.applyLocationUserInput.bind(this),r.EmulationModel.Location.latitudeValidator,!0,.1),this.latitudeSetter(String(e.latitude)),o.Tooltip.Tooltip.install(this.latitudeInput,O),f.appendChild(o.UIUtils.createLabel(b(g.latitude),"latlong-title",this.latitudeInput)),this.longitudeInput=o.UIUtils.createInput("","number","longitude"),S.appendChild(this.longitudeInput),this.longitudeInput.setAttribute("step","any"),this.longitudeInput.value="0",this.longitudeSetter=o.UIUtils.bindInput(this.longitudeInput,this.applyLocationUserInput.bind(this),r.EmulationModel.Location.longitudeValidator,!0,.1),this.longitudeSetter(String(e.longitude)),o.Tooltip.Tooltip.install(this.longitudeInput,O),S.appendChild(o.UIUtils.createLabel(b(g.longitude),"latlong-title",this.longitudeInput)),this.timezoneInput=o.UIUtils.createInput("","text","timezone"),C.appendChild(this.timezoneInput),this.timezoneInput.value="Europe/Berlin",this.timezoneSetter=o.UIUtils.bindInput(this.timezoneInput,this.applyLocationUserInput.bind(this),r.EmulationModel.Location.timezoneIdValidator,!1),this.timezoneSetter(e.timezoneId),C.appendChild(o.UIUtils.createLabel(b(g.timezoneId),"timezone-title",this.timezoneInput)),this.timezoneError=C.createChild("div","timezone-error"),this.localeInput=o.UIUtils.createInput("","text","locale"),E.appendChild(this.localeInput),this.localeInput.value="en-US",this.localeSetter=o.UIUtils.bindInput(this.localeInput,this.applyLocationUserInput.bind(this),r.EmulationModel.Location.localeValidator,!1),this.localeSetter(e.locale),E.appendChild(o.UIUtils.createLabel(b(g.locale),"locale-title",this.localeInput)),this.localeError=E.createChild("div","locale-error")}#o(){this.fieldsetElement.disabled=!1,this.timezoneError.textContent="";const t=this.locationSelectElement.options[this.locationSelectElement.selectedIndex].value;if(t===x.NoOverride)this.#i=!1,this.clearFieldsetElementInputs(),this.fieldsetElement.disabled=!0;else if(t===x.Custom){this.#i=!0;const t=r.EmulationModel.Location.parseUserInput(this.latitudeInput.value.trim(),this.longitudeInput.value.trim(),this.timezoneInput.value.trim(),this.localeInput.value.trim());if(!t)return;this.#e=t}else if(t===x.Unavailable)this.#i=!0,this.#e=new r.EmulationModel.Location(0,0,"","",!0);else{this.#i=!0;const e=JSON.parse(t);this.#e=new r.EmulationModel.Location(e.lat,e.long,e.timezoneId,e.locale,!1),this.latitudeSetter(e.lat),this.longitudeSetter(e.long),this.timezoneSetter(e.timezoneId),this.localeSetter(e.locale)}this.applyLocation(),t===x.Custom&&this.latitudeInput.focus()}applyLocationUserInput(){const t=r.EmulationModel.Location.parseUserInput(this.latitudeInput.value.trim(),this.longitudeInput.value.trim(),this.timezoneInput.value.trim(),this.localeInput.value.trim());t&&(this.timezoneError.textContent="",this.setSelectElementLabel(this.locationSelectElement,x.Custom),this.#e=t,this.applyLocation())}applyLocation(){this.#i?this.#t.set(this.#e.toSetting()):this.#t.set("");for(const t of r.TargetManager.TargetManager.instance().models(r.EmulationModel.EmulationModel))t.emulateLocation(this.#i?this.#e:null).catch((t=>{switch(t.type){case"emulation-set-timezone":this.timezoneError.textContent=t.message;break;case"emulation-set-locale":this.localeError.textContent=t.message}}))}clearFieldsetElementInputs(){this.latitudeSetter("0"),this.longitudeSetter("0"),this.timezoneSetter(""),this.localeSetter("")}createDeviceOrientationSection(){const t=this.contentElement.createChild("section","sensors-group");t.setAttribute("jslog",`${n.section("device-orientation")}`);const e=o.UIUtils.createLabel(b(g.orientation),"sensors-group-title");t.appendChild(e);const i=t.createChild("div","orientation-content"),a=i.createChild("div","orientation-fields"),r={title:b(g.off),orientation:x.NoOverride,jslogContext:"off"},l={title:b(g.customOrientation),orientation:x.Custom},s=[{title:b(g.presets),value:[{title:b(g.portrait),orientation:"[0, 90, 0]",jslogContext:"portrait"},{title:b(g.portraitUpsideDown),orientation:"[180, -90, 0]",jslogContext:"portrait-upside-down"},{title:b(g.landscapeLeft),orientation:"[90, 0, -90]",jslogContext:"landscape-left"},{title:b(g.landscapeRight),orientation:"[90, -180, -90]",jslogContext:"landscape-right"},{title:b(g.displayUp),orientation:"[0, 0, 0]",jslogContext:"display-up"},{title:b(g.displayDown),orientation:"[0, -180, 0]",jslogContext:"displayUp-down"}]}];this.orientationSelectElement=this.contentElement.createChild("select"),this.orientationSelectElement.setAttribute("jslog",`${n.dropDown().track({change:!0})}`),o.ARIAUtils.bindLabelToControl(e,this.orientationSelectElement),this.orientationSelectElement.appendChild(o.UIUtils.createOption(r.title,r.orientation,r.jslogContext)),this.orientationSelectElement.appendChild(o.UIUtils.createOption(l.title,l.orientation,"custom"));for(let t=0;t<s.length;++t){const e=this.orientationSelectElement.createChild("optgroup");e.label=s[t].title;const i=s[t].value;for(let t=0;t<i.length;++t)e.appendChild(o.UIUtils.createOption(i[t].title,i[t].orientation,i[t].jslogContext))}this.orientationSelectElement.selectedIndex=0,a.appendChild(this.orientationSelectElement),this.orientationSelectElement.addEventListener("change",this.orientationSelectChanged.bind(this)),this.deviceOrientationFieldset=this.createDeviceOrientationOverrideElement(this.deviceOrientation),this.stageElement=i.createChild("div","orientation-stage"),this.stageElement.setAttribute("jslog",`${n.preview().track({drag:!0})}`),this.orientationLayer=this.stageElement.createChild("div","orientation-layer"),this.boxElement=this.orientationLayer.createChild("section","orientation-box orientation-element"),this.boxElement.createChild("section","orientation-front orientation-element"),this.boxElement.createChild("section","orientation-top orientation-element"),this.boxElement.createChild("section","orientation-back orientation-element"),this.boxElement.createChild("section","orientation-left orientation-element"),this.boxElement.createChild("section","orientation-right orientation-element"),this.boxElement.createChild("section","orientation-bottom orientation-element"),o.UIUtils.installDragHandle(this.stageElement,this.onBoxDragStart.bind(this),(t=>{this.onBoxDrag(t)}),null,"-webkit-grabbing","-webkit-grab"),a.appendChild(this.deviceOrientationFieldset),this.enableOrientationFields(!0),this.setBoxOrientation(this.deviceOrientation,!1)}createPressureSection(){const e=this.contentElement.createChild("div","pressure-section"),i=o.SettingsUI.createControlForSetting(t.Settings.Settings.instance().moduleSetting("emulation.cpu-pressure"),b(g.forcesSelectedPressureStateEmulation));i&&e.appendChild(i)}enableOrientationFields(t){t?(this.deviceOrientationFieldset.disabled=!0,this.stageElement.classList.add("disabled"),o.Tooltip.Tooltip.install(this.stageElement,b(g.enableOrientationToRotate))):(this.deviceOrientationFieldset.disabled=!1,this.stageElement.classList.remove("disabled"),o.Tooltip.Tooltip.install(this.stageElement,b(g.shiftdragHorizontallyToRotate)))}orientationSelectChanged(){const t=this.orientationSelectElement.options[this.orientationSelectElement.selectedIndex].value;if(this.enableOrientationFields(!1),t===x.NoOverride)this.deviceOrientationOverrideEnabled=!1,this.enableOrientationFields(!0),this.applyDeviceOrientation();else if(t===x.Custom)this.deviceOrientationOverrideEnabled=!0,this.resetDeviceOrientation(),this.alphaElement.focus();else{const e=JSON.parse(t);this.deviceOrientationOverrideEnabled=!0,this.deviceOrientation=new r.EmulationModel.DeviceOrientation(e[0],e[1],e[2]),this.setDeviceOrientation(this.deviceOrientation,"selectPreset")}}applyDeviceOrientation(){this.deviceOrientationOverrideEnabled&&this.deviceOrientationSetting.set(this.deviceOrientation.toSetting());for(const t of r.TargetManager.TargetManager.instance().models(r.EmulationModel.EmulationModel))t.emulateDeviceOrientation(this.deviceOrientationOverrideEnabled?this.deviceOrientation:null)}setSelectElementLabel(t,e){const i=Array.prototype.map.call(t.options,(t=>t.value));t.selectedIndex=i.indexOf(e)}applyDeviceOrientationUserInput(){this.setDeviceOrientation(r.EmulationModel.DeviceOrientation.parseUserInput(this.alphaElement.value.trim(),this.betaElement.value.trim(),this.gammaElement.value.trim()),"userInput"),this.setSelectElementLabel(this.orientationSelectElement,x.Custom)}resetDeviceOrientation(){this.setDeviceOrientation(new r.EmulationModel.DeviceOrientation(0,90,0),"resetButton"),this.setSelectElementLabel(this.orientationSelectElement,"[0, 90, 0]")}setDeviceOrientation(t,e){if(!t)return;function i(t){return Math.round(1e4*t)/1e4}"userInput"!==e&&(this.alphaSetter(String(i(t.alpha))),this.betaSetter(String(i(t.beta))),this.gammaSetter(String(i(t.gamma))));const n="userDrag"!==e;this.setBoxOrientation(t,n),this.deviceOrientation=t,this.applyDeviceOrientation(),o.ARIAUtils.alert(b(g.deviceOrientationSetToAlphaSBeta,{PH1:t.alpha,PH2:t.beta,PH3:t.gamma}))}createAxisInput(t,e,i,n){const a=t.createChild("div","orientation-axis-input-container");return a.appendChild(e),a.appendChild(o.UIUtils.createLabel(i,"",e)),o.UIUtils.bindInput(e,this.applyDeviceOrientationUserInput.bind(this),n,!0)}createDeviceOrientationOverrideElement(t){const e=document.createElement("fieldset");e.classList.add("device-orientation-override-section");const i=e.createChild("td","orientation-inputs-cell");this.alphaElement=o.UIUtils.createInput("","number","alpha"),this.alphaElement.setAttribute("step","any"),this.alphaSetter=this.createAxisInput(i,this.alphaElement,b(g.alpha),r.EmulationModel.DeviceOrientation.alphaAngleValidator),this.alphaSetter(String(t.alpha)),this.betaElement=o.UIUtils.createInput("","number","beta"),this.betaElement.setAttribute("step","any"),this.betaSetter=this.createAxisInput(i,this.betaElement,b(g.beta),r.EmulationModel.DeviceOrientation.betaAngleValidator),this.betaSetter(String(t.beta)),this.gammaElement=o.UIUtils.createInput("","number","gamma"),this.gammaElement.setAttribute("step","any"),this.gammaSetter=this.createAxisInput(i,this.gammaElement,b(g.gamma),r.EmulationModel.DeviceOrientation.gammaAngleValidator),this.gammaSetter(String(t.gamma));const n=o.UIUtils.createTextButton(b(g.reset),this.resetDeviceOrientation.bind(this),{className:"orientation-reset-button",jslogContext:"sensors.reset-device-orientiation"});return o.ARIAUtils.setLabel(n,b(g.resetDeviceOrientation)),n.setAttribute("type","reset"),i.appendChild(n),e}setBoxOrientation(t,e){e?this.stageElement.classList.add("is-animating"):this.stageElement.classList.remove("is-animating");const{alpha:i,beta:o,gamma:n}=t;this.boxMatrix=(new DOMMatrixReadOnly).rotate(0,0,i).rotate(o,0,0).rotate(0,n,0),this.orientationLayer.style.transform=`rotateY(${i}deg) rotateX(${-o}deg) rotateZ(${n}deg)`}onBoxDrag(t){const e=this.calculateRadiusVector(t.x,t.y);if(!e)return!0;if(!this.mouseDownVector)return!0;let i,n;t.consume(!0),t.shiftKey?(i=new o.Geometry.Vector(0,0,1),n=(e.x-this.mouseDownVector.x)*S):(i=o.Geometry.crossProduct(this.mouseDownVector,e),n=o.Geometry.calculateAngle(this.mouseDownVector,e));const a=(new DOMMatrixReadOnly).rotateAxisAngle(-i.x,i.z,i.y,n).multiply(this.originalBoxMatrix),l=o.Geometry.EulerAngles.fromDeviceOrientationRotationMatrix(a),s=new r.EmulationModel.DeviceOrientation(l.alpha,l.beta,l.gamma);return this.setDeviceOrientation(s,"userDrag"),this.setSelectElementLabel(this.orientationSelectElement,x.Custom),!1}onBoxDragStart(t){return!!this.deviceOrientationOverrideEnabled&&(this.mouseDownVector=this.calculateRadiusVector(t.x,t.y),this.originalBoxMatrix=this.boxMatrix,!!this.mouseDownVector&&(t.consume(!0),!0))}calculateRadiusVector(t,e){const i=this.stageElement.getBoundingClientRect(),n=Math.max(i.width,i.height)/2,a=(t-i.left-i.width/2)/n,r=(e-i.top-i.height/2)/n,l=a*a+r*r;return l>.5?new o.Geometry.Vector(a,r,.5/Math.sqrt(l)):new o.Geometry.Vector(a,r,Math.sqrt(1-l))}appendTouchControl(){const e=this.contentElement.createChild("div","touch-section"),i=o.SettingsUI.createControlForSetting(t.Settings.Settings.instance().moduleSetting("emulation.touch"),b(g.forcesTouchInsteadOfClick));i&&e.appendChild(i)}appendIdleEmulator(){const e=this.contentElement.createChild("div","idle-section"),i=o.SettingsUI.createControlForSetting(t.Settings.Settings.instance().moduleSetting("emulation.idle-detection"),b(g.forcesSelectedIdleStateEmulation));i&&e.appendChild(i)}createHardwareConcurrencySection(){const t=this.contentElement.createChild("div","concurrency-section"),{checkbox:e,numericInput:i,reset:o,warning:n}=l.ThrottlingManager.throttlingManager().createHardwareConcurrencySelector(),a=document.createElement("div");a.classList.add("concurrency-details"),a.append(i.element,o.element,n.element),t.append(e,a)}}const x={NoOverride:"noOverride",Custom:"custom",Unavailable:"unavailable"};const S=16;var C=Object.freeze({__proto__:null,NonPresetOptions:x,PressureOptions:{NoOverride:"no-override",Nominal:"nominal",Fair:"fair",Serious:"serious",Critical:"critical"},SensorsView:f,ShiftDragOrientationSpeed:S,ShowActionDelegate:class{handleAction(t,e){return o.ViewManager.ViewManager.instance().showView("sensors"),!0}}});export{p as LocationsSettingsTab,C as SensorsView};
